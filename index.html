<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Shutter Chance Hunter - NAKAYAMA Gallery</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --color-dark: #0a0a0a;
            --color-gold: #d4af37;
            --color-white: #ffffff;
            --color-gray: #666;
            --color-light-gray: #999;
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background: var(--color-dark);
            color: var(--color-white);
            overflow: hidden;
            touch-action: none;
            height: 100vh;
            position: relative;
        }

        /* Title Screen */
        .title-screen {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.5s ease-out;
        }

        .title-screen.hidden {
            display: none;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .game-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 3rem;
            color: var(--color-gold);
            text-align: center;
            margin-bottom: 1rem;
            letter-spacing: 3px;
            line-height: 1.2;
        }

        .game-subtitle {
            font-size: 1rem;
            color: var(--color-light-gray);
            margin-bottom: 3rem;
            text-align: center;
            letter-spacing: 2px;
        }

        .start-button {
            padding: 1.2rem 3rem;
            background: var(--color-gold);
            color: var(--color-dark);
            border: none;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            letter-spacing: 1px;
        }

        .start-button:active {
            transform: scale(0.95);
        }

        /* Stage Select */
        .stage-select {
            position: fixed;
            inset: 0;
            background: var(--color-dark);
            display: none;
            flex-direction: column;
            padding: 2rem 1rem;
            z-index: 900;
        }

        .stage-select.active {
            display: flex;
        }

        .stage-select-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2rem;
            color: var(--color-gold);
            text-align: center;
            margin-bottom: 2rem;
            letter-spacing: 2px;
        }

        .stages-container {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            flex: 1;
            overflow-y: auto;
        }

        .stage-card {
            background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
            border: 2px solid var(--color-gold);
            border-radius: 15px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .stage-card:active {
            transform: scale(0.98);
        }

        .stage-card.locked {
            opacity: 0.5;
            border-color: var(--color-gray);
        }

        .stage-number {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.5rem;
            color: var(--color-gold);
            margin-bottom: 0.5rem;
        }

        .stage-name {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stage-description {
            font-size: 0.9rem;
            color: var(--color-light-gray);
            margin-bottom: 0.5rem;
        }

        .stage-reward {
            font-size: 0.85rem;
            color: var(--color-gold);
            font-weight: 500;
        }

        .completed-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: var(--color-gold);
            color: var(--color-dark);
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
        }

        /* Game Screen */
        .game-screen {
            position: fixed;
            inset: 0;
            display: none;
            flex-direction: column;
        }

        .game-screen.active {
            display: flex;
        }

        /* Game HUD */
        .game-hud {
            padding: 1rem;
            background: rgba(10, 10, 10, 0.9);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--color-gold);
            z-index: 100;
        }

        .hud-left {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .back-button {
            width: 40px;
            height: 40px;
            background: rgba(212, 175, 55, 0.2);
            border: 2px solid var(--color-gold);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.5rem;
            color: var(--color-gold);
            transition: all 0.3s;
        }

        .back-button:active {
            transform: scale(0.9);
        }

        .stage-info {
            font-size: 0.9rem;
            color: var(--color-gold);
            font-weight: 700;
        }

        .hint-button {
            padding: 0.5rem 1rem;
            background: rgba(212, 175, 55, 0.2);
            border: 2px solid var(--color-gold);
            border-radius: 25px;
            color: var(--color-gold);
            font-size: 0.85rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }

        .hint-button:active {
            transform: scale(0.95);
        }

        /* Game Canvas */
        .game-canvas {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: #1a1a1a;
        }

        .scene {
            width: 100%;
            height: 100%;
            position: relative;
            background-size: cover;
            background-position: center;
            transition: transform 0.3s ease-out;
            animation: cameraShake 0.1s infinite;
        }

        @keyframes cameraShake {
            0% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(0.5px, 0.3px) rotate(0.1deg); }
            50% { transform: translate(-0.3px, 0.5px) rotate(-0.05deg); }
            75% { transform: translate(0.4px, -0.2px) rotate(0.08deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }

        .scene.beach {
            background: linear-gradient(180deg, #87CEEB 0%, #F4A460 50%, #D2691E 100%);
            position: relative;
            overflow: hidden;
        }

        .scene.beach::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 70% 30%, rgba(255, 200, 100, 0.3) 0%, transparent 50%);
            animation: lightChange 8s ease-in-out infinite;
            z-index: 1;
        }

        /* Beach elements */
        .beach-palm {
            position: absolute;
            width: 150px;
            height: 300px;
            background: linear-gradient(to top, #8B4513 0%, #8B4513 60%, transparent 60%);
            transition: transform 0.3s ease-out;
            z-index: 2;
        }

        .beach-palm::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 150px;
            background: radial-gradient(ellipse at center, #228B22 0%, #006400 100%);
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
        }

        .beach-palm.left {
            left: 10%;
            bottom: 0;
        }

        .beach-palm.right {
            right: 15%;
            bottom: 0;
        }

        .beach-umbrella {
            position: absolute;
            width: 120px;
            height: 200px;
            left: 45%;
            bottom: 0;
            transition: transform 0.3s ease-out;
            z-index: 2;
        }

        .beach-umbrella::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 8px;
            height: 100px;
            background: #8B4513;
        }

        .beach-umbrella::after {
            content: '';
            position: absolute;
            bottom: 90px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 100px;
            background: conic-gradient(from 0deg, #FF6B6B, #FFE66D, #4ECDC4, #FF6B6B);
            border-radius: 50% 50% 0 0;
            clip-path: polygon(0% 50%, 50% 0%, 100% 50%, 50% 100%);
        }

        .beach-person {
            position: absolute;
            width: 60px;
            height: 120px;
            bottom: 20%;
            left: 30%;
            transition: transform 0.3s ease-out;
            z-index: 3;
        }

        .beach-person::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 60px;
            background: #FFB6C1;
            border-radius: 15px 15px 5px 5px;
        }

        .beach-person::after {
            content: '';
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            width: 25px;
            height: 25px;
            background: #FFDAB9;
            border-radius: 50%;
        }

        .scene.urban {
            background: linear-gradient(180deg, #2c3e50 0%, #34495e 50%, #95a5a6 100%);
            position: relative;
            overflow: hidden;
        }

        .scene.urban::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 50% 40%, rgba(255, 220, 150, 0.2) 0%, transparent 60%);
            animation: lightChange 10s ease-in-out infinite;
            z-index: 1;
        }

        /* Urban elements */
        .urban-building {
            position: absolute;
            bottom: 0;
            background: linear-gradient(to bottom, #34495e, #2c3e50);
            border-top: 3px solid #d4af37;
            transition: transform 0.3s ease-out;
            z-index: 2;
        }

        .urban-building.left {
            left: 5%;
            width: 180px;
            height: 350px;
        }

        .urban-building.center {
            left: 35%;
            width: 150px;
            height: 280px;
        }

        .urban-building.right {
            right: 8%;
            width: 200px;
            height: 400px;
        }

        .urban-building::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            background-image: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 30px,
                    rgba(255, 220, 100, 0.3) 30px,
                    rgba(255, 220, 100, 0.3) 35px
                ),
                repeating-linear-gradient(
                    90deg,
                    transparent,
                    transparent 30px,
                    rgba(255, 220, 100, 0.3) 30px,
                    rgba(255, 220, 100, 0.3) 35px
                );
        }

        .urban-street-light {
            position: absolute;
            width: 15px;
            height: 250px;
            bottom: 0;
            background: linear-gradient(to bottom, #d4af37, #8B7428);
            transition: transform 0.3s ease-out;
            z-index: 3;
        }

        .urban-street-light.left {
            left: 25%;
        }

        .urban-street-light.right {
            right: 25%;
        }

        .urban-street-light::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 30px;
            background: radial-gradient(circle, rgba(255, 220, 100, 0.8), transparent);
            border-radius: 50%;
        }

        .urban-person {
            position: absolute;
            width: 50px;
            height: 100px;
            bottom: 15%;
            left: 50%;
            transition: transform 0.3s ease-out;
            z-index: 4;
        }

        .urban-person::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 25px;
            height: 50px;
            background: #2c3e50;
            border-radius: 12px 12px 3px 3px;
        }

        .urban-person::after {
            content: '';
            position: absolute;
            bottom: 45px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 20px;
            background: #FFDAB9;
            border-radius: 50%;
        }

        @keyframes lightChange {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.1); }
        }

        /* Hot spots */
        .hotspot {
            position: absolute;
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, rgba(212, 175, 55, 0.3) 0%, transparent 70%);
            border: 3px dashed var(--color-gold);
            border-radius: 50%;
            cursor: pointer;
            animation: pulse 2s ease-in-out infinite;
            display: none;
        }

        .hotspot.show-hint {
            display: block;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.6; }
            50% { transform: scale(1.1); opacity: 1; }
        }

        /* Camera viewfinder */
        .viewfinder {
            position: absolute;
            inset: 0;
            pointer-events: none;
            display: none;
        }

        .viewfinder.active {
            display: block;
        }

        .viewfinder-frame {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            max-width: 400px;
            aspect-ratio: 3/4;
            border: 3px solid var(--color-gold);
            box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.7);
        }

        .viewfinder-crosshair {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 30px;
            height: 30px;
        }

        .viewfinder-crosshair::before,
        .viewfinder-crosshair::after {
            content: '';
            position: absolute;
            background: var(--color-gold);
        }

        .viewfinder-crosshair::before {
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            transform: translateY(-50%);
        }

        .viewfinder-crosshair::after {
            left: 50%;
            top: 0;
            bottom: 0;
            width: 2px;
            transform: translateX(-50%);
        }

        /* Controls */
        .game-controls {
            padding: 1.5rem;
            background: rgba(10, 10, 10, 0.9);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: center;
            gap: 1rem;
            border-top: 2px solid var(--color-gold);
        }

        .control-button {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
            border: 3px solid var(--color-gold);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
        }

        .control-button:active {
            transform: scale(0.9);
            background: var(--color-gold);
        }

        .shutter-button {
            width: 90px;
            height: 90px;
            background: var(--color-gold);
            border-color: var(--color-white);
            font-size: 2rem;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
        }

        .shutter-button:active {
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.8);
        }

        /* Result Modal */
        .result-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            animation: fadeIn 0.3s ease-out;
        }

        .result-modal.active {
            display: flex;
        }

        .result-content {
            background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
            border: 3px solid var(--color-gold);
            border-radius: 20px;
            padding: 2rem;
            max-width: 90%;
            text-align: center;
            animation: scaleIn 0.3s ease-out;
        }

        @keyframes scaleIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .result-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2.5rem;
            color: var(--color-gold);
            margin-bottom: 1rem;
            letter-spacing: 2px;
        }

        .result-message {
            font-size: 1.1rem;
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .result-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .result-button {
            padding: 1rem 2rem;
            background: var(--color-gold);
            color: var(--color-dark);
            border: none;
            border-radius: 30px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }

        .result-button:active {
            transform: scale(0.95);
        }

        .result-button.secondary {
            background: transparent;
            border: 2px solid var(--color-gold);
            color: var(--color-gold);
        }

        /* Gallery Modal */
        .gallery-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            flex-direction: column;
            z-index: 1500;
        }

        .gallery-modal.active {
            display: flex;
        }

        .gallery-header {
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--color-gold);
        }

        .gallery-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.5rem;
            color: var(--color-gold);
            letter-spacing: 2px;
        }

        .close-button {
            width: 40px;
            height: 40px;
            background: rgba(212, 175, 55, 0.2);
            border: 2px solid var(--color-gold);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.5rem;
            color: var(--color-gold);
        }

        .close-button:active {
            transform: scale(0.9);
        }

        .gallery-content {
            flex: 1;
            overflow-y: auto;
            padding: 2rem 1rem;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .gallery-item {
            aspect-ratio: 3/4;
            background: #1a1a1a;
            border-radius: 10px;
            overflow: hidden;
            cursor: pointer;
            position: relative;
        }

        .gallery-item img,
        .gallery-item video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .gallery-item.locked {
            background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: var(--color-gray);
        }

        .gallery-button {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            background: var(--color-gold);
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(212, 175, 55, 0.5);
            z-index: 800;
            transition: all 0.3s;
        }

        .gallery-button:active {
            transform: scale(0.9);
        }

        @media (min-width: 768px) {
            .gallery-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Title Screen -->
    <div class="title-screen" id="titleScreen">
        <h1 class="game-title">SHUTTER<br>CHANCE<br>HUNTER</h1>
        <p class="game-subtitle">NAKAYAMA MASAFUMI</p>
        <button class="start-button" onclick="showStageSelect()">START GAME</button>
    </div>

    <!-- Stage Select -->
    <div class="stage-select" id="stageSelect">
        <h2 class="stage-select-title">SELECT STAGE</h2>
        <div class="stages-container">
            <div class="stage-card" onclick="startStage(1)">
                <span class="stage-number">STAGE 01</span>
                <h3 class="stage-name">Beach Paradise</h3>
                <p class="stage-description">Â§ïÊöÆ„Çå„ÅÆ„Éì„Éº„ÉÅ„ÅßÂÆåÁíß„Å™„Ç¢„É≥„Ç∞„É´„ÇíÊé¢„Åõ</p>
                <p class="stage-reward">üéÅ Â†±ÈÖ¨: ÂÜôÁúü √ó 4</p>
                <div class="completed-badge" id="stage1Complete" style="display: none;">‚úì COMPLETED</div>
            </div>
            <div class="stage-card" id="stage2Card">
                <span class="stage-number">STAGE 02</span>
                <h3 class="stage-name">Urban Elegance</h3>
                <p class="stage-description">ÈÉΩ‰ºö„ÅÆÂ§úÊôØ„ÅÆ‰∏≠„ÅßÂãï„Åç„ÇíÊçâ„Åà„Çç</p>
                <p class="stage-reward">üéÅ Â†±ÈÖ¨: ÂãïÁîª √ó 1</p>
                <div class="completed-badge" id="stage2Complete" style="display: none;">‚úì COMPLETED</div>
            </div>
        </div>
    </div>

    <!-- Game Screen -->
    <div class="game-screen" id="gameScreen">
        <div class="game-hud">
            <div class="hud-left">
                <div class="back-button" onclick="backToStageSelect()">‚Üê</div>
                <div class="stage-info" id="stageInfo">STAGE 01</div>
            </div>
            <button class="hint-button" onclick="toggleHint()">üí° „Éí„É≥„Éà</button>
        </div>
        
        <div class="game-canvas">
            <div class="scene" id="scene">
                <!-- Beach elements -->
                <div class="beach-palm left" id="beachPalmLeft"></div>
                <div class="beach-palm right" id="beachPalmRight"></div>
                <div class="beach-umbrella" id="beachUmbrella"></div>
                <div class="beach-person" id="beachPerson"></div>
                
                <!-- Urban elements -->
                <div class="urban-building left" id="urbanBuildingLeft"></div>
                <div class="urban-building center" id="urbanBuildingCenter"></div>
                <div class="urban-building right" id="urbanBuildingRight"></div>
                <div class="urban-street-light left" id="urbanLightLeft"></div>
                <div class="urban-street-light right" id="urbanLightRight"></div>
                <div class="urban-person" id="urbanPerson"></div>
                
                <div class="hotspot" id="hotspot" style="top: 40%; left: 50%; transform: translate(-50%, -50%);"></div>
            </div>
            <div class="viewfinder" id="viewfinder">
                <div class="viewfinder-frame">
                    <div class="viewfinder-crosshair"></div>
                </div>
            </div>
        </div>

        <div class="game-controls">
            <div class="control-button" onclick="moveCamera('left')">‚Üê</div>
            <div class="control-button shutter-button" onclick="takePhoto()">üì∑</div>
            <div class="control-button" onclick="moveCamera('right')">‚Üí</div>
        </div>
    </div>

    <!-- Result Modal -->
    <div class="result-modal" id="resultModal">
        <div class="result-content">
            <h2 class="result-title" id="resultTitle">PERFECT SHOT!</h2>
            <p class="result-message" id="resultMessage">Á¥†Êô¥„Çâ„Åó„ÅÑÊßãÂõ≥„Åß„Åô!<br>„Éó„É≠„ÅÆÂÜôÁúü„Åå„Ç¢„É≥„É≠„ÉÉ„ÇØ„Åï„Çå„Åæ„Åó„Åü!</p>
            <div class="result-buttons">
                <button class="result-button" onclick="viewGallery()">„ÇÆ„É£„É©„É™„Éº„ÇíË¶ã„Çã</button>
                <button class="result-button secondary" onclick="closeResult()">Á∂ö„Åë„Çã</button>
            </div>
        </div>
    </div>

    <!-- Gallery Modal -->
    <div class="gallery-modal" id="galleryModal">
        <div class="gallery-header">
            <h2 class="gallery-title">PHOTO COLLECTION</h2>
            <div class="close-button" onclick="closeGallery()">√ó</div>
        </div>
        <div class="gallery-content">
            <div class="gallery-grid" id="galleryGrid">
                <!-- Gallery items will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Gallery Button (Floating) -->
    <button class="gallery-button" onclick="viewGallery()" style="display: none;" id="galleryButton">üìö</button>

    <script>
        // Audio Context for sound effects
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        // Shutter sound effect
        function playShutterSound() {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 800;
            oscillator.type = 'square';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.1);
        }
        
        // Success sound effect
        function playSuccessSound() {
            const frequencies = [523.25, 659.25, 783.99]; // C-E-G chord
            frequencies.forEach((freq, index) => {
                setTimeout(() => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = freq;
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.5);
                }, index * 100);
            });
        }
        
        // Ambient sound (wave or city)
        let ambientOscillator = null;
        let ambientGain = null;
        
        function playAmbientSound(type) {
            stopAmbientSound();
            
            ambientOscillator = audioContext.createOscillator();
            ambientGain = audioContext.createGain();
            
            ambientOscillator.connect(ambientGain);
            ambientGain.connect(audioContext.destination);
            
            if (type === 'beach') {
                ambientOscillator.frequency.value = 100;
                ambientOscillator.type = 'sine';
                ambientGain.gain.value = 0.05;
            } else {
                ambientOscillator.frequency.value = 150;
                ambientOscillator.type = 'triangle';
                ambientGain.gain.value = 0.03;
            }
            
            ambientOscillator.start();
        }
        
        function stopAmbientSound() {
            if (ambientOscillator) {
                ambientOscillator.stop();
                ambientOscillator = null;
            }
        }
    
        // Game State
        let gameState = {
            currentStage: 1,
            cameraPosition: 0,
            showHint: false,
            unlockedPhotos: [],
            completedStages: [],
            autoShakeInterval: null
        };

        // Auto shake camera randomly
        function startAutoShake() {
            stopAutoShake();
            gameState.autoShakeInterval = setInterval(() => {
                const randomShake = (Math.random() - 0.5) * 25; // Random shake between -12.5 and 12.5 (increased from 8)
                gameState.cameraPosition += randomShake;
                gameState.cameraPosition = Math.max(-40, Math.min(40, gameState.cameraPosition)); // Increased range from 30 to 40
                updateCameraView();
            }, 500); // Shake every 0.5 seconds (decreased from 2000)
        }

        function stopAutoShake() {
            if (gameState.autoShakeInterval) {
                clearInterval(gameState.autoShakeInterval);
                gameState.autoShakeInterval = null;
            }
        }

        // Update camera view with parallax effect
        function updateCameraView() {
            const scene = document.getElementById('scene');
            const normalizedPos = gameState.cameraPosition / 40; // Changed from 30 to 40
            
            // Move background
            scene.style.transform = `translateX(${gameState.cameraPosition * 0.8}%)`; // Increased from 0.5 to 0.8
            
            // Get all scene elements
            const elements = scene.querySelectorAll('.beach-palm, .beach-umbrella, .beach-person, .urban-building, .urban-street-light, .urban-person');
            
            elements.forEach(element => {
                let depth = 1;
                
                // Different parallax depths for different elements
                if (element.classList.contains('beach-palm') || element.classList.contains('urban-building')) {
                    depth = 2.5; // Far background (increased from 1.5)
                } else if (element.classList.contains('beach-umbrella') || element.classList.contains('urban-street-light')) {
                    depth = 1.8; // Mid ground (increased from 1.2)
                } else {
                    depth = 0.5; // Foreground (decreased from 0.8 - moves more opposite)
                }
                
                element.style.transform = `translateX(${normalizedPos * depth * 80}px)`; // Increased from 50 to 80
            });
        }

        // Stage configurations
        const stages = {
            1: {
                name: 'Beach Paradise',
                scene: 'beach',
                hotspotPosition: { top: '40%', left: '50%' },
                tolerance: 8, // Decreased from 15 to 8 - must be more precise
                rewards: ['sample1.png', 'sample2.png', 'sample3.png', 'sample4.png']
            },
            2: {
                name: 'Urban Elegance',
                scene: 'urban',
                hotspotPosition: { top: '50%', left: '45%' },
                tolerance: 6, // Decreased from 15 to 6 - even harder
                rewards: ['sample5.mp4']
            }
        };

        // Load game state from localStorage
        function loadGameState() {
            const saved = localStorage.getItem('shutterChanceHunter');
            if (saved) {
                const savedState = JSON.parse(saved);
                gameState.unlockedPhotos = savedState.unlockedPhotos || [];
                gameState.completedStages = savedState.completedStages || [];
                updateUI();
            }
        }

        // Save game state
        function saveGameState() {
            localStorage.setItem('shutterChanceHunter', JSON.stringify({
                unlockedPhotos: gameState.unlockedPhotos,
                completedStages: gameState.completedStages
            }));
        }

        // Update UI based on game state
        function updateUI() {
            // Update completed badges
            gameState.completedStages.forEach(stageNum => {
                const badge = document.getElementById(`stage${stageNum}Complete`);
                if (badge) badge.style.display = 'block';
            });

            // Update stage 2 lock
            const stage2Card = document.getElementById('stage2Card');
            if (!gameState.completedStages.includes(1)) {
                stage2Card.classList.add('locked');
                stage2Card.onclick = () => alert('„Çπ„ÉÜ„Éº„Ç∏1„Çí„ÇØ„É™„Ç¢„Åó„Å¶„Åè„Å†„Åï„ÅÑ!');
            } else {
                stage2Card.classList.remove('locked');
                stage2Card.onclick = () => startStage(2);
            }

            // Show gallery button if any photos unlocked
            const galleryButton = document.getElementById('galleryButton');
            if (gameState.unlockedPhotos.length > 0) {
                galleryButton.style.display = 'flex';
            }
        }

        // Show stage select
        function showStageSelect() {
            document.getElementById('titleScreen').classList.add('hidden');
            document.getElementById('stageSelect').classList.add('active');
        }

        // Start stage
        function startStage(stageNum) {
            if (stageNum === 2 && !gameState.completedStages.includes(1)) {
                return;
            }

            gameState.currentStage = stageNum;
            gameState.cameraPosition = 0;
            gameState.showHint = false;

            const stage = stages[stageNum];
            
            // Update UI
            document.getElementById('stageSelect').classList.remove('active');
            document.getElementById('gameScreen').classList.add('active');
            document.getElementById('stageInfo').textContent = `STAGE 0${stageNum}`;
            
            // Setup scene
            const scene = document.getElementById('scene');
            scene.className = `scene ${stage.scene}`;
            scene.style.transform = 'translateX(0)';
            
            // Show/hide elements based on stage
            const beachElements = ['beachPalmLeft', 'beachPalmRight', 'beachUmbrella', 'beachPerson'];
            const urbanElements = ['urbanBuildingLeft', 'urbanBuildingCenter', 'urbanBuildingRight', 'urbanLightLeft', 'urbanLightRight', 'urbanPerson'];
            
            beachElements.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.style.display = stage.scene === 'beach' ? 'block' : 'none';
            });
            
            urbanElements.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.style.display = stage.scene === 'urban' ? 'block' : 'none';
            });
            
            // Setup hotspot
            const hotspot = document.getElementById('hotspot');
            hotspot.style.top = stage.hotspotPosition.top;
            hotspot.style.left = stage.hotspotPosition.left;
            hotspot.classList.remove('show-hint');
            
            // Play ambient sound
            playAmbientSound(stage.scene);
            
            // Start auto shake
            startAutoShake();
        }

        // Back to stage select
        function backToStageSelect() {
            document.getElementById('gameScreen').classList.remove('active');
            document.getElementById('stageSelect').classList.add('active');
            document.getElementById('viewfinder').classList.remove('active');
            stopAmbientSound();
            stopAutoShake();
        }

        // Toggle hint
        function toggleHint() {
            gameState.showHint = !gameState.showHint;
            const hotspot = document.getElementById('hotspot');
            if (gameState.showHint) {
                hotspot.classList.add('show-hint');
            } else {
                hotspot.classList.remove('show-hint');
            }
        }

        // Move camera
        function moveCamera(direction) {
            const step = 10;
            if (direction === 'left') {
                gameState.cameraPosition = Math.max(-40, gameState.cameraPosition - step); // Changed from -30 to -40
            } else {
                gameState.cameraPosition = Math.min(40, gameState.cameraPosition + step); // Changed from 30 to 40
            }
            
            updateCameraView();
        }

        // Take photo
        function takePhoto() {
            // Play shutter sound
            playShutterSound();
            
            const viewfinder = document.getElementById('viewfinder');
            viewfinder.classList.add('active');
            
            // Flash effect
            setTimeout(() => {
                viewfinder.style.background = 'rgba(255, 255, 255, 0.9)';
                setTimeout(() => {
                    viewfinder.style.background = '';
                    viewfinder.classList.remove('active');
                    checkShot();
                }, 100);
            }, 200);
        }

        // Check if shot is good
        function checkShot() {
            const stage = stages[gameState.currentStage];
            const tolerance = stage.tolerance;
            
            // Simple check: camera should be near center
            if (Math.abs(gameState.cameraPosition) <= tolerance) {
                // Success!
                showResult(true);
            } else {
                // Try again
                showResult(false);
            }
        }

        // Show result
        function showResult(success) {
            const modal = document.getElementById('resultModal');
            const title = document.getElementById('resultTitle');
            const message = document.getElementById('resultMessage');
            
            if (success) {
                // Play success sound
                playSuccessSound();
                
                const stage = stages[gameState.currentStage];
                
                // Unlock rewards
                stage.rewards.forEach(photo => {
                    if (!gameState.unlockedPhotos.includes(photo)) {
                        gameState.unlockedPhotos.push(photo);
                    }
                });
                
                // Mark stage as completed
                if (!gameState.completedStages.includes(gameState.currentStage)) {
                    gameState.completedStages.push(gameState.currentStage);
                }
                
                saveGameState();
                updateUI();
                
                title.textContent = 'PERFECT SHOT!';
                message.innerHTML = `Á¥†Êô¥„Çâ„Åó„ÅÑÊßãÂõ≥„Åß„Åô!<br>${stage.rewards.length}„Å§„ÅÆ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Åå„Ç¢„É≥„É≠„ÉÉ„ÇØ„Åï„Çå„Åæ„Åó„Åü!`;
            } else {
                title.textContent = 'TRY AGAIN';
                message.textContent = '„ÇÇ„ÅÜÂ∞ë„ÅóË™øÊï¥„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜ„ÄÇ\n„Éí„É≥„Éà„Éú„Çø„É≥„ÇíÊäº„Åô„Å®ÁõÆÂÆâ„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô„ÄÇ';
            }
            
            modal.classList.add('active');
        }

        // Close result
        function closeResult() {
            document.getElementById('resultModal').classList.remove('active');
            
            // If success, go back to stage select
            if (gameState.completedStages.includes(gameState.currentStage)) {
                backToStageSelect();
            }
        }

        // View gallery
        function viewGallery() {
            document.getElementById('resultModal').classList.remove('active');
            
            const gallery = document.getElementById('galleryModal');
            const grid = document.getElementById('galleryGrid');
            
            // Clear grid
            grid.innerHTML = '';
            
            // All possible photos
            const allPhotos = [
                'sample1.png', 'sample2.png', 'sample3.png', 'sample4.png', 'sample5.mp4'
            ];
            
            allPhotos.forEach(photo => {
                const item = document.createElement('div');
                item.className = 'gallery-item';
                
                if (gameState.unlockedPhotos.includes(photo)) {
                    if (photo.endsWith('.mp4')) {
                        item.innerHTML = `<video src="${photo}" controls playsinline></video>`;
                    } else {
                        item.innerHTML = `<img src="${photo}" alt="Photo">`;
                    }
                } else {
                    item.classList.add('locked');
                    item.innerHTML = 'üîí';
                }
                
                grid.appendChild(item);
            });
            
            gallery.classList.add('active');
        }

        // Close gallery
        function closeGallery() {
            document.getElementById('galleryModal').classList.remove('active');
        }

        // Initialize
        loadGameState();
        updateUI();
    </script>
</body>
</html>
